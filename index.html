<!-- from https://github.com/aryomuzakki/new-year-countdown -->

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="New Year Count Down" />
  <meta name="keywords" content="new year, count, down, new year count down" />
  <meta name="author" content="Chan Myae Maung" />
  <title>New Year Count Down</title>

  <link rel="stylesheet" href="https://mmwebfonts.comquas.com/fonts/?font=notosanzawgyi" />
  <link rel="icon" href="https://converter.chanmyaemaung.net/favicon/favicon.ico" />
  <link rel="manifest" href="https://converter.chanmyaemaung.net/favicon/manifest.json" />

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap");

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
    }

    body {
      background-image: url("./bg.jpg");
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center center;
      height: 100vh;
      overflow: hidden;
      color: #fff;
      font-family: "Poppins", sans-serif;

      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align-last: center;

      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* Ghost: Dark Overlay */
    body::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 0;
    }

    body * {
      z-index: 1;
    }

    h1 {
      font-size: clamp(36px, 7vw, 72px);
      margin: -80px 0 40px;
      text-align: center;
    }

    .year {
      font-size: clamp(80px, 32vw, 200px);
      line-height: 1;
      z-index: 0;
      opacity: 0.25;
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      pointer-events: none;
      margin: 0;
    }

    .countDown {
      display: none;
      justify-content: space-evenly;
    }

    .time {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      /* margin: 2.4vw; */
    }

    .time h2 {
      font-size: clamp(18px, 4.4vw, 48px);
      margin: 0;
      line-height: 1;
    }

    .time small {
      font-size: clamp(16px, 4.1vw, 40px);
      margin: 0;
      line-height: 1;
    }

    /* Fireworks canvas (hidden until countdown hits 0) */
    #canvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      display: none;
      /* shown when countdown ends */
      z-index: 2;
      /* above overlay + content */
      pointer-events: auto;
      /* allow click to launch */
    }

    /* Happy New Year message (hidden until countdown hits 0) */
    #celebrate {
      position: fixed;
      inset: 0;
      display: none;
      /* shown when countdown ends */
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 3;
      /* above canvas */
      text-align: center;
      padding: 24px;
      pointer-events: none;
    }

    #celebrate h2 {
      margin: 0;
      font-size: clamp(36px, 6vw, 72px);
      text-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
    }

    #celebrate p {
      margin: 10px 0 0;
      font-size: clamp(14px, 2.2vw, 20px);
      opacity: 0.9;
      text-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
    }

    #audioToggle {
      position: fixed;
      right: 16px;
      top: 16px;
      z-index: 4;
      border: 1px solid rgba(255, 255, 255, .25);
      background: rgba(0, 0, 0, .25);
      color: #ffffffbf;
      padding: 10px 12px;
      border-radius: 999px;
      font-family: inherit;
      font-size: 14px;
      cursor: pointer;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      display: inline-flex;
      pointer-events: auto;
      transition: transform .25s;
    }

    #audioToggle:active {
      transform: scale(.98);
    }

    #audioToggle[aria-pressed="true"] {
      background: rgba(0, 0, 0, .65);
    }

    @media (max-width: 500px) {
      /* h1 {
        font-size: 30px;
      } */

      .time {
        margin: 5px;
      }

      .time h2 {
        /* font-size: 12px; */
        margin: 0;
      }

      /* .time small {
        font-size: 10px;
      } */

      /* .year {
        font-size: 120px;
      } */
    }
  </style>
</head>

<body>
  <!-- Fireworks Canvas -->
  <canvas id="canvas">Your browser does not support the 'canvas' element.</canvas>

  <!-- Happy New Year Overlay -->
  <div id="celebrate">
    <h2 id="happyText">Happy New Year!</h2>
    <p id="happySub">Wishing you a year full of wins âœ¨</p>
  </div>

  <!-- New Year -->
  <p id="year" class="year"></p>

  <!-- Title -->
  <div class="wrapper">
    <h1 id="title">New Year Count Down</h1>

    <!-- Count Down Wrapper -->
    <div id="countDown" class="countDown">
      <div class="time">
        <h2 id="days">00</h2>
        <small>days</small>
      </div>
      <div class="time">
        <h2 id="hours">00</h2>
        <small>hours</small>
      </div>
      <div class="time">
        <h2 id="minutes">00</h2>
        <small>minutes</small>
      </div>
      <div class="time">
        <h2 id="seconds">00</h2>
        <small>seconds</small>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <img src="./spinner.gif" alt="Loading..." id="loading" class="loading" />

  <button id="audioToggle" type="button" aria-pressed="false" title="Tap to enable or mute sound">
    ðŸ”‡ Enable Sound
  </button>

  <audio id="fireworkAudio" src="./fireworks.mp3" preload="auto" loop muted></audio>

  <script>
    /* =========================
       COUNTDOWN
    ========================== */
    const days = document.getElementById("days");
    const hours = document.getElementById("hours");
    const minutes = document.getElementById("minutes");
    const seconds = document.getElementById("seconds");
    const countDown = document.getElementById("countDown");
    const loading = document.getElementById("loading");
    const year = document.getElementById("year");
    const title = document.getElementById("title");

    const canvas = document.getElementById("canvas");
    const celebrate = document.getElementById("celebrate");

    const currentYear = new Date().getFullYear();

    // âœ… use real new year (uncomment this for production)
    const newYearTime = new Date(`January 01 ${currentYear + 1} 00:00:00`);

    // for demo
    // const newYearTime = new Date(new Date().getTime() + 1000 * 3);

    year.innerText = currentYear + 1;

    const audio = document.getElementById("fireworkAudio");
    const audioToggle = document.getElementById("audioToggle");

    let audioUnlocked = false;
    let isMuted = true;

    function setAudioUI() {
      const soundOn = audioUnlocked && !isMuted;
      audioToggle.setAttribute("aria-pressed", soundOn ? "true" : "false");
      audioToggle.textContent = soundOn ? "ðŸ”Š Sound enabled" : "ðŸ”‡ Enable sound";
      audioToggle.title = soundOn ? "Mute sound" : "Tap to enable or mute sound";
      audioToggle.style.color = soundOn ? "#ffffffe6" : "#ffffffbf";
    }

    function tryPlayAudio() {
      if (!audio) return Promise.reject();
      audio.volume = 0.7;
      audio.muted = isMuted;
      return audio.play();
    }

    setAudioUI();

    audioToggle.addEventListener("click", async () => {
      // toggle mute
      isMuted = !isMuted;
      if (audio) audio.muted = isMuted;

      // if turning sound ON, try to unlock/play (requires user gesture)
      if (!isMuted) {
        try {
          await tryPlayAudio();
          audioUnlocked = true;
        } catch (e) {
          // still blocked -> revert to muted
          audioUnlocked = false;
          isMuted = true;
          if (audio) audio.muted = true;
        }
      }
      setAudioUI();
    });

    let countdownDone = false;
    let intervalId = null;

    function updateCountDown() {
      const currentTime = new Date();
      const diff = newYearTime - currentTime;

      if (diff <= 0) {
        // clamp to 0
        days.innerText = "0";
        hours.innerText = "00";
        minutes.innerText = "00";
        seconds.innerText = "00";

        if (!countdownDone) {
          countdownDone = true;
          onCountdownFinish();
        }
        return;
      }

      const d = Math.floor(diff / 1000 / 60 / 60 / 24);
      const h = Math.floor(diff / 1000 / 60 / 60) % 24;
      const m = Math.floor(diff / 1000 / 60) % 60;
      const s = Math.floor(diff / 1000) % 60;

      days.innerText = String(d);
      hours.innerText = h < 10 ? "0" + h : String(h);
      minutes.innerText = m < 10 ? "0" + m : String(m);
      seconds.innerText = s < 10 ? "0" + s : String(s);
    }

    function onCountdownFinish() {
      // stop countdown tick
      if (intervalId) clearInterval(intervalId);

      // hide countdown UI (optional)
      countDown.style.display = "none";
      title.style.display = "none";

      // show fireworks + message
      canvas.style.display = "block";
      celebrate.style.display = "flex";

      // ðŸ”Š START AUDIO (loop)
      if (audio) {
        audio.currentTime = 0;
        audio.volume = 0.7;

        // If user already enabled sound earlier, play with sound.
        // Otherwise, start muted (silent) and wait for button click to unmute.
        audio.muted = isMuted;

        tryPlayAudio().then(() => {
          if (!isMuted) audioUnlocked = true; // user already clicked before finish
          setAudioUI();
        }).catch(() => {
          // ignore; user can unlock by pressing the button
          setAudioUI();
        });
      }

      // start fireworks loop
      startFireworks();
    }

    // Show Spinner before Count Down
    setTimeout(() => {
      loading.remove();
      countDown.style.display = "flex";
    }, 1000);

    // initial paint + tick
    updateCountDown();
    intervalId = setInterval(updateCountDown, 1000);

    /* =========================
       FIREWORKS (only starts at 0)
    ========================== */
    function startFireworks() {
      // === CONFIGURATION ===
      const FIREWORK_ACCELERATION = 1.05;
      const FIREWORK_BRIGHTNESS_MIN = 50;
      const FIREWORK_BRIGHTNESS_MAX = 70;
      const FIREWORK_SPEED = 5;
      const FIREWORK_TRAIL_LENGTH = 3;
      const FIREWORK_TARGET_INDICATOR_ENABLED = true;

      const PARTICLE_BRIGHTNESS_MIN = 50;
      const PARTICLE_BRIGHTNESS_MAX = 80;
      const PARTICLE_COUNT = 100;
      const PARTICLE_DECAY_MIN = 0.015;
      const PARTICLE_DECAY_MAX = 0.03;
      const PARTICLE_FRICTION = 0.95;
      const PARTICLE_GRAVITY = 0.7;
      const PARTICLE_HUE_VARIANCE = 20;
      const PARTICLE_TRANSPARENCY = 1;
      const PARTICLE_SPEED_MIN = 1;
      const PARTICLE_SPEED_MAX = 10;
      const PARTICLE_TRAIL_LENGTH = 5;

      const CANVAS_CLEANUP_ALPHA = 0.15;
      const HUE_STEP_INCREASE = 0.5;

      const TICKS_PER_FIREWORK_MIN = 5;
      const TICKS_PER_FIREWORK_AUTOMATED_MIN = 20;
      const TICKS_PER_FIREWORK_AUTOMATED_MAX = 80;

      // === LOCAL VARS ===
      // Fit canvas to viewport + keep in sync on resize
      const context = canvas.getContext("2d");

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      let fireworks = [],
        particles = [];
      let mouseX = 0,
        mouseY = 0;
      let isMouseDown = false;
      let hue = 120;
      let ticksSinceFireworkAutomated = 0;
      let ticksSinceFirework = 0;

      // === HELPERS ===
      const requestAnimFrame =
        window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        function (callback) {
          window.setTimeout(callback, 1000 / 60);
        };

      function random(min, max) {
        return Math.random() * (max - min) + min;
      }

      function calculateDistance(aX, aY, bX, bY) {
        const xDistance = aX - bX;
        const yDistance = aY - bY;
        return Math.sqrt(xDistance * xDistance + yDistance * yDistance);
      }

      // === EVENT LISTENERS ===
      canvas.addEventListener("mousemove", (e) => {
        mouseX = e.pageX - canvas.offsetLeft;
        mouseY = e.pageY - canvas.offsetTop;
      });

      canvas.addEventListener("mousedown", (e) => {
        e.preventDefault();
        isMouseDown = true;
      });

      canvas.addEventListener("mouseup", (e) => {
        e.preventDefault();
        isMouseDown = false;
      });

      // (touch support)
      canvas.addEventListener(
        "touchstart",
        (e) => {
          e.preventDefault();
          isMouseDown = true;
          const t = e.touches[0];
          mouseX = t.pageX - canvas.offsetLeft;
          mouseY = t.pageY - canvas.offsetTop;
        },
        { passive: false }
      );
      canvas.addEventListener(
        "touchmove",
        (e) => {
          e.preventDefault();
          const t = e.touches[0];
          mouseX = t.pageX - canvas.offsetLeft;
          mouseY = t.pageY - canvas.offsetTop;
        },
        { passive: false }
      );
      canvas.addEventListener(
        "touchend",
        (e) => {
          e.preventDefault();
          isMouseDown = false;
        },
        { passive: false }
      );

      // === PROTOTYPES ===
      function Firework(startX, startY, endX, endY) {
        this.x = startX;
        this.y = startY;
        this.startX = startX;
        this.startY = startY;
        this.endX = endX;
        this.endY = endY;
        this.distanceToEnd = calculateDistance(startX, startY, endX, endY);
        this.distanceTraveled = 0;

        this.trail = [];
        this.trailLength = FIREWORK_TRAIL_LENGTH;
        while (this.trailLength--) this.trail.push([this.x, this.y]);

        this.angle = Math.atan2(endY - startY, endX - startX);
        this.speed = FIREWORK_SPEED;
        this.acceleration = FIREWORK_ACCELERATION;
        this.brightness = random(
          FIREWORK_BRIGHTNESS_MIN,
          FIREWORK_BRIGHTNESS_MAX
        );
        this.targetRadius = 2.5;
      }

      Firework.prototype.update = function (index) {
        this.trail.pop();
        this.trail.unshift([this.x, this.y]);

        if (FIREWORK_TARGET_INDICATOR_ENABLED) {
          if (this.targetRadius < 8) this.targetRadius += 0.3;
          else this.targetRadius = 1;
        }

        this.speed *= this.acceleration;

        const xVelocity = Math.cos(this.angle) * this.speed;
        const yVelocity = Math.sin(this.angle) * this.speed;

        this.distanceTraveled = calculateDistance(
          this.startX,
          this.startY,
          this.x + xVelocity,
          this.y + yVelocity
        );

        if (this.distanceTraveled >= this.distanceToEnd) {
          fireworks.splice(index, 1);
          createParticles(this.endX, this.endY);
        } else {
          this.x += xVelocity;
          this.y += yVelocity;
        }
      };

      Firework.prototype.draw = function () {
        context.beginPath();
        const trailEndX = this.trail[this.trail.length - 1][0];
        const trailEndY = this.trail[this.trail.length - 1][1];
        context.moveTo(trailEndX, trailEndY);
        context.lineTo(this.x, this.y);
        context.strokeStyle = `hsl(${hue}, 100%, ${this.brightness}%)`;
        context.stroke();

        if (FIREWORK_TARGET_INDICATOR_ENABLED) {
          context.beginPath();
          context.arc(this.endX, this.endY, this.targetRadius, 0, Math.PI * 2);
          context.stroke();
        }
      };

      function Particle(x, y) {
        this.x = x;
        this.y = y;
        this.angle = random(0, Math.PI * 2);
        this.friction = PARTICLE_FRICTION;
        this.gravity = PARTICLE_GRAVITY;
        this.hue = random(hue - PARTICLE_HUE_VARIANCE, hue + PARTICLE_HUE_VARIANCE);
        this.brightness = random(
          PARTICLE_BRIGHTNESS_MIN,
          PARTICLE_BRIGHTNESS_MAX
        );
        this.decay = random(PARTICLE_DECAY_MIN, PARTICLE_DECAY_MAX);
        this.speed = random(PARTICLE_SPEED_MIN, PARTICLE_SPEED_MAX);

        this.trail = [];
        this.trailLength = PARTICLE_TRAIL_LENGTH;
        while (this.trailLength--) this.trail.push([this.x, this.y]);

        this.transparency = PARTICLE_TRANSPARENCY;
      }

      Particle.prototype.update = function (index) {
        this.trail.pop();
        this.trail.unshift([this.x, this.y]);

        this.speed *= this.friction;
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed + this.gravity;

        this.transparency -= this.decay;
        if (this.transparency <= this.decay) particles.splice(index, 1);
      };

      Particle.prototype.draw = function () {
        context.beginPath();
        const trailEndX = this.trail[this.trail.length - 1][0];
        const trailEndY = this.trail[this.trail.length - 1][1];
        context.moveTo(trailEndX, trailEndY);
        context.lineTo(this.x, this.y);
        context.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.transparency})`;
        context.stroke();
      };

      // === APP HELPERS ===
      function cleanCanvas() {
        context.globalCompositeOperation = "destination-out";
        context.fillStyle = `rgba(0, 0, 0, ${CANVAS_CLEANUP_ALPHA})`;
        context.fillRect(0, 0, canvas.width, canvas.height);
        context.globalCompositeOperation = "lighter";
      }

      function createParticles(x, y) {
        let particleCount = PARTICLE_COUNT;
        while (particleCount--) particles.push(new Particle(x, y));
      }

      function launchAutomatedFirework() {
        if (
          ticksSinceFireworkAutomated >=
          random(TICKS_PER_FIREWORK_AUTOMATED_MIN, TICKS_PER_FIREWORK_AUTOMATED_MAX)
        ) {
          if (!isMouseDown) {
            const startX = canvas.width / 2;
            const startY = canvas.height;
            const endX = random(0, canvas.width);
            const endY = random(0, canvas.height / 2);
            fireworks.push(new Firework(startX, startY, endX, endY));
            ticksSinceFireworkAutomated = 0;
          }
        } else {
          ticksSinceFireworkAutomated++;
        }
      }

      function launchManualFirework() {
        if (ticksSinceFirework >= TICKS_PER_FIREWORK_MIN) {
          if (isMouseDown) {
            const startX = canvas.width / 2;
            const startY = canvas.height;
            const endX = mouseX;
            const endY = mouseY;
            fireworks.push(new Firework(startX, startY, endX, endY));
            ticksSinceFirework = 0;
          }
        } else {
          ticksSinceFirework++;
        }
      }

      function updateFireworks() {
        for (let i = fireworks.length - 1; i >= 0; --i) {
          fireworks[i].draw();
          fireworks[i].update(i);
        }
      }

      function updateParticles() {
        for (let i = particles.length - 1; i >= 0; --i) {
          particles[i].draw();
          particles[i].update(i);
        }
      }

      // === LOOP ===
      function loop() {
        requestAnimFrame(loop);

        hue += HUE_STEP_INCREASE;
        cleanCanvas();

        updateFireworks();
        updateParticles();

        launchAutomatedFirework();
        launchManualFirework();
      }

      // start immediately (only called when countdown ends)
      loop();
    }
  </script>
</body>

</html>